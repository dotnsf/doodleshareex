<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8"/>
<title>ベーシック認証編集</title>
<script type="text/javascript" src="//code.jquery.com/jquery-2.2.4.min.js"></script>
<link href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet"/>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
<link rel="stylesheet" href="//cdn.datatables.net/t/bs-3.3.6/jqc-1.12.0,dt-1.10.11/datatables.min.css"/> 
<script src="//cdn.datatables.net/t/bs-3.3.6/jqc-1.12.0,dt-1.10.11/datatables.min.js"></script>

<link href="/colorbox.css" rel="stylesheet"/>
<script src="/jquery.colorbox-min.js"></script>
<script src="/common.js"></script>

<meta name="viewport" content="width=device-width,initial-scale=1"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>

<script>
var uuid = generateUUID();

var rooms = [];
$(function(){
  $.extend( $.fn.dataTable.defaults, {
    language: {
      url: '//cdn.datatables.net/plug-ins/9dcbecd42ad/i18n/Japanese.json'
    }
  });
  $('#form1').submit( function(){
    var room = $('#room').val();
    if( room ){
      $.ajax({
        type: 'GET',
        url: '/db/room/' + room,
        success: function( result ){
          //console.log( result );
          if( result ){
            if( result.status ){
              //. room が存在している
              alert( '指定したルーム: ' + room + ' は登録済でした。認証情報の変更または削除が可能です。')
              $('#room').val( '' );
              $('#room_name_2').html( room );
              $('#div_0').css( 'display', 'none' );
              $('#div_2').css( 'display', 'block' );
            }else{
              //. room が存在していない
              alert( '指定したルーム: ' + room + ' は未登録でした。認証情報を指定して新規作成が可能です。')
              $('#room').val( '' );
              $('#room_name_1').html( room );
              $('#div_0').css( 'display', 'none' );
              $('#div_1').css( 'display', 'block' );
            }
          }
        },
        error: function( e0, e1, e2 ){
          console.log( e0, e1, e2 );
          //. room が存在していない
          alert( '指定したルーム: ' + room + ' は未登録でした。認証情報を指定して新規作成が可能です。')
          $('#room').val( '' );
          $('#room_name_1').html( room );
          $('#div_0').css( 'display', 'none' );
          $('#div_1').css( 'display', 'block' );
        }
      });
    }
    return false;
  });
});

function newBasicIDPW(){
  var room = $('#room_name_1').html();
  var id = $('#basic_id').val();
  var pw = $('#basic_password').val();
  var data = {
    basic_id: id,
    basic_password: pw,
    uuid: uuid
  };

  $.ajax({
    type: 'POST',
    url: '/db/room/' + room,
    data: data,
    success: function( result ){
      if( result && result.status ){
        console.log( result );
        alert( '指定した room: ' + room  + ' を新規登録しました。' );
        $('#room_name_1').html( '' );
        $('#div_0').css( 'display', 'block' );
        $('#div_1').css( 'display', 'none' );
      }
    },
    error: function( e0, e1, e2 ){
      console.log( e0, e1, e2 );
      alert( '指定した room: ' + room  + ' の作成に失敗しました(' + e2 + ')。' );
    }
  });
}

function updateBasicIDPW(){
  var room = $('#room_name_2').html();
  var old_id = $('#old_basic_id').val();
  var old_pw = $('#old_basic_password').val();
  var new_id = $('#new_basic_id').val();
  var new_pw = $('#new_basic_password').val();
  var data = {
    basic_id: old_id,
    basic_password: old_pw,
    new_basic_id: new_id,
    new_basic_password: new_pw,
    uuid: uuid
  };

  $.ajax({
    type: 'PUT',
    url: '/db/room/' + room,
    data: data,
    success: function( result ){
      if( result && result.status ){
        console.log( result );
        alert( '指定した room: ' + room  + ' を更新しました。' );
        $('#room_name_2').html( '' );
        $('#div_0').css( 'display', 'block' );
        $('#div_2').css( 'display', 'none' );
      }
    },
    error: function( e0, e1, e2 ){
      console.log( e0, e1, e2 );
      alert( '指定した room: ' + room  + ' の更新に失敗しました(' + e2 + ')。現在の ID & PW が間違っている可能性があります。' );
    }
  });
}

function deleteBasicIDPW(){
  var room = $('#room_name_2').html();
  var id = $('#old_basic_id').val();
  var pw = $('#old_basic_password').val();
  var data = {
    basic_id: id,
    basic_password: pw,
    uuid: uuid
  };

  $.ajax({
    type: 'DELETE',
    url: '/db/room/' + room,
    data: data,
    success: function( result ){
      if( result && result.status ){
        console.log( result );
        alert( '指定した room: ' + room  + ' を削除しました。' );
        $('#room_name_2').html( '' );
        $('#div_0').css( 'display', 'block' );
        $('#div_2').css( 'display', 'none' );
      }
    },
    error: function( e0, e1, e2 ){
      console.log( e0, e1, e2 );
      alert( '指定した room: ' + room  + ' の削除に失敗しました(' + e2 + ')。現在の ID & PW が間違っている可能性があります。' );
    }
  });
}

function cancelProcess(){
  $('#room').val( '' );
  $('#div_0').css( 'display', 'block' );
  $('#div_1').css( 'display', 'none' );
  $('#div_2').css( 'display', 'none' );
}
</script>

<style type="text/css">
html, body{
  text-align: center;
  background-color: #fafafa;
  font-size: 20px;
  color: #333;
}
</style>
</head>
<body>

<h1>ルーム検索</h1>

<div class="container" id="div_0">
  <div>
    <table style="width: 100%;">
      <tr>
        <td>
          <form id="form1">
          ルーム <input type="text" class="form-control" value="" id="room"/>
          </form>
        </td>
      </tr>
    </table>
  </div>
</div>

<div class="container" id="div_1" style="display:none;">
  <h1 id="room_name_1"></h1>
  <table class="table">
    <tr>
      <td>ID</td>
      <td><input type="text" class="form-control" id="basic_id"/></td>
    </tr>
    <tr>
      <td>Password</td>
      <td><input type="password" class="form-control" id="basic_password"/></td>
    </tr>
  </table>
  <button class="btn btn-xs btn-primary" onClick="newBasicIDPW();">作成</button>
  <button class="btn btn-xs btn-secondary" onClick="cancelProcess();">キャンセル</button>
</div>

<div class="container" id="div_2" style="display:none;">
  <h1 id="room_name_2"></h1>
  <table class="table">
    <tr>
      <td>Current ID</td>
      <td><input type="text" class="form-control" id="old_basic_id"/></td>
    </tr>
    <tr>
      <td>Current Password</td>
      <td><input type="password" class="form-control" id="old_basic_password"/></td>
    </tr>
    <tr>
      <td>New ID</td>
      <td><input type="text" class="form-control" id="new_basic_id"/></td>
    </tr>
    <tr>
      <td>New Password</td>
      <td><input type="password" class="form-control" id="new_basic_password"/></td>
    </tr>
  </table>
  <button class="btn btn-xs btn-primary" onClick="updateBasicIDPW();">更新</button>
  <button class="btn btn-xs btn-danger" onClick="deleteBasicIDPW();">削除</button>
  <button class="btn btn-xs btn-secondary" onClick="cancelProcess();">キャンセル</button>
</div>

<div class="modal bd-example-modal-lg fade" id="imagesModal" tabindex="-1" role="dialog" aria-labbelledby="imagesModal" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title" id="imagesModalLabel"></h4>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body" id="imagesmodal-body">
        <div id="card-groups">
        </div>
      </div>
      <div class="modal-footer btn-center">
        <!--
        <button type="button" class="btn btn-info btn-xs py-0" onClick="migrateFrom();"><i class="fas fa-file-export"></i></button>
        -->
      </div>
    </div>
  </div>
</div>


</body>
</html>
